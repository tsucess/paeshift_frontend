var x=(d,f,o)=>new Promise((v,n)=>{var j=a=>{try{m(o.next(a))}catch(N){n(N)}},h=a=>{try{m(o.throw(a))}catch(N){n(N)}},m=a=>a.done?v(a.value):Promise.resolve(a.value).then(j,h);m((o=o.apply(d,f)).next())});import{j as e}from"./index-DzfYAV6B.js";import{u as U,f as P,r as u}from"./router-vendor-nz_fvPt4.js";import{l as O}from"./logo-sm-CwMTbstP.js";import{F as I,f as L}from"./icon-vendor-Y_MkwwPz.js";import{L as A,y,l as k}from"./notification-vendor-CcIVbC0l.js";import{a as V}from"./index-Cfc3znND.js";import"./react-vendor-DCaiJ6vv.js";import"./query-vendor-VOXR0irk.js";import"./ui-vendor-DQeT9Y3U.js";const J=()=>{const d=U(),f=P(),[o,v]=u.useState(""),[n,j]=u.useState("signup"),[h,m]=u.useState(!1),[a,N]=u.useState(60),[b,S]=u.useState(new Array(6).fill("")),[C,D]=u.useState(!1);u.useEffect(()=>{var c,l;const s=new URLSearchParams(f.search),i=s.get("email"),r=s.get("type");i?v(i):(c=f.state)!=null&&c.email&&v(f.state.email),r?j(r):(l=f.state)!=null&&l.verificationType&&j(f.state.verificationType)},[f]),u.useEffect(()=>{if(a<=0)return;const s=setInterval(()=>{N(i=>i-1)},1e3);return()=>clearInterval(s)},[a]);const g=s=>y.success(s,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:k}),p=s=>y.error(s,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:k});function E(s,i){if(isNaN(s.target.value))return!1;S([...b.map((c,l)=>l===i?s.target.value:c)]),s.target.value&&s.target.nextSibling&&s.target.nextSibling.focus(),b.every((c,l)=>l===i?s.target.value!=="":c!=="")&&i===5&&s.target.value!==""&&setTimeout(()=>{_({preventDefault:()=>{}})},500)}function R(){return x(this,null,function*(){var s,i;if(!(a>0)){if(!o){p("Email is required to resend OTP");return}m(!0);try{const r=yield V.post("http://127.0.0.1:8000/accountsapp/otp/request",{email:o,type:n});r.status===200&&r.data.message?(g("OTP has been resent to your email"),N(60)):p(r.data.message||"Failed to resend OTP")}catch(r){console.error("Resend OTP error:",r),p(((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.message)||"An error occurred while resending OTP")}finally{m(!1)}}})}function _(s){return x(this,null,function*(){var r,c,l,w;if(s.preventDefault(),C){console.log("Verification already in progress, skipping duplicate call");return}const i=b.join("");if(i.length!==6){p("Please enter all 6 digits of the OTP");return}if(!o){p("Email is required for verification");return}m(!0),D(!0);try{if(console.log(`Verifying OTP for ${o} with type ${n}`),n==="registration"||n==="signup"){const t=yield V.post("http://127.0.0.1:8000/accountsapp/verify-registration",{email:o,code:i,type:"registration"});if(console.log("Registration verification response:",t.data),t.data.message){g("Account activated successfully! Please login to continue."),setTimeout(()=>{d("/signin")},1500);return}}else{const t=yield V.post("http://127.0.0.1:8000/accountsapp/otp/verify",{email:o,code:i,type:n});if(console.log("OTP verification response:",t.data),t.data.message&&t.data.message.includes("successfully"))switch(g(t.data.message||"OTP verification successful"),n){case"login":t.data.access_token?(localStorage.setItem("access_token",t.data.access_token),console.log("Access token stored successfully")):t.data.token?(localStorage.setItem("access_token",t.data.token),console.log("Token stored as access_token")):console.warn("No token received from server"),t.data.user_id&&(localStorage.setItem("user_id",t.data.user_id),console.log("User ID stored successfully:",t.data.user_id)),t.data.role&&(localStorage.setItem("user_role",t.data.role),console.log("User role stored successfully:",t.data.role)),g("Login successful! Redirecting to dashboard..."),setTimeout(()=>{d("/dashboard")},1500);break;case"password_reset":g("OTP verified successfully. You can now reset your password."),setTimeout(()=>{d("/create-password",{state:{email:o,reset_token:t.data.reset_token}})},1500);break;default:g("Verification successful! Redirecting..."),setTimeout(()=>{d("/")},1500)}else p(t.data.message||"OTP verification failed")}}catch(t){console.error("OTP verification error:",t);const T=((c=(r=t.response)==null?void 0:r.data)==null?void 0:c.message)||((w=(l=t.response)==null?void 0:l.data)==null?void 0:w.error)||"An error occurred during verification";p(T)}finally{m(!1),D(!1)}})}return e.jsxDEV("div",{className:"row m-0 px-2 otp_wrapper animate__animated animate__fadeIn",children:e.jsxDEV("div",{className:"col-12 col-md-4 main-card animate__animated animate__zoomIn",children:[e.jsxDEV("div",{className:"col-12 bg-card-2"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:277,columnNumber:17},void 0),e.jsxDEV("div",{className:"col-12 bg-card-3"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:278,columnNumber:17},void 0),e.jsxDEV("div",{className:"bg-card",children:[e.jsxDEV("div",{children:e.jsxDEV(A,{},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:281,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:280,columnNumber:21},void 0),e.jsxDEV("div",{className:"row",children:[e.jsxDEV("div",{className:"col-3",children:e.jsxDEV("button",{onClick:()=>d(-1),className:"text-dark btn btn-link p-0",children:e.jsxDEV(I,{icon:L},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:289,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:285,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:284,columnNumber:25},void 0),e.jsxDEV("div",{className:"col-6 text-center",children:e.jsxDEV("img",{src:O,className:"brand-logo ms-2",alt:"Paeshift logo"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:293,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:292,columnNumber:25},void 0),e.jsxDEV("div",{className:"col-3"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:295,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:283,columnNumber:21},void 0),e.jsxDEV("div",{className:"row content",children:e.jsxDEV("div",{className:"col-12 px-0",children:[e.jsxDEV("div",{className:"title",children:[e.jsxDEV("h3",{children:"OTP verification"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:300,columnNumber:33},void 0),e.jsxDEV("p",{children:[n==="signup"&&"Verify your account by entering the OTP sent to your email.",n==="login"&&"Enter the OTP sent to your email to complete login.",n==="password_reset"&&"Enter the OTP sent to your email to reset your password.",!["signup","login","password_reset"].includes(n)&&"Enter the OTP sent to your email."]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:301,columnNumber:33},void 0),o&&e.jsxDEV("p",{className:"text-primary",children:o},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:307,columnNumber:43},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:299,columnNumber:29},void 0),e.jsxDEV("form",{className:"otp_form",onSubmit:_,children:[e.jsxDEV("div",{className:"mb-2 otp_area",children:b.map((s,i)=>e.jsxDEV("input",{type:"text",maxLength:1,className:"form-control",name:"otp",value:s,onChange:r=>E(r,i),onKeyDown:r=>{r.key==="Backspace"&&!r.target.value&&r.target.previousSibling&&(r.preventDefault(),r.target.previousSibling.focus())},disabled:h},i,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:315,columnNumber:49},void 0))},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:311,columnNumber:33},void 0),e.jsxDEV("p",{className:"mt-3",children:["Didn't get Code?",a>0?e.jsxDEV("span",{children:[" Resend OTP in ",Math.floor(a/60),":",String(a%60).padStart(2,"0")]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:338,columnNumber:41},void 0):e.jsxDEV("a",{href:"#",onClick:s=>{s.preventDefault(),R()},children:" Resend OTP now"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:340,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:335,columnNumber:33},void 0),e.jsxDEV("button",{type:"submit",name:"submit",className:"btn primary-btn w-100 mt-2",disabled:h,children:h?"Verifying...":"Verify Code"},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:344,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:309,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:298,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:297,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:279,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:276,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/Rise Networks/Documents/paeshift_project/paeshift-frontend/src/pages/VerificationScreen.jsx",lineNumber:275,columnNumber:9},void 0)};export{J as default};
